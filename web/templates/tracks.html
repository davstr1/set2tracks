{% extends "base.html" %}

{% block content %}

{% include 'snippets/explore_submenu.html' %}

<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
<style>
  input[type=range]::-webkit-slider-thumb {
    pointer-events: all;
    width: 24px;
    height: 24px;
    -webkit-appearance: none;
    /* @apply w-6 h-6 appearance-none pointer-events-auto; */
  }
</style>

<form id="search_tracks" action="{{ url_for('track.tracks') }}">

  <div class="flex space-y-1">
    <!-- Left side with the search field -->
    <div class="flex flex-col w-full lg:w-2/3 mb-4">

      <div class="relative w-full">
        <input type="text" class="form-input w-full pr-10 bg-gray-800 text-white border-gray-700 placeholder-gray-500" name="s" placeholder="Search tracks or artist in {{results_count}} tracks" value="{{ search }}">
        {% if search %}
        <span class="absolute inset-y-0 right-10 flex items-center pr-3 text-gray-500">{{ results_count }} results</span>
        <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-gray-300 focus:outline-none" onclick="document.querySelector('input[name=\'s\']').value='';document.getElementById('search_tracks').submit();">
          <svg class="h-5 w-5 rounded-full bg-gray-600 hover:bg-gray-500 p-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
        {% endif %}
      </div>

      {% with min=year_min_default, max=year_max_default, min_val=year_min, max_val=year_max, min_val_name='year_min', max_val_name='year_max', label='Year' %}
      {% include 'snippets/range_slider.html' %}
      {% endwith %}

      {% with min=bpm_min_default, max=bpm_max_default, min_val=bpm_min, max_val=bpm_max, min_val_name='bpm_min', max_val_name='bpm_max', label='BPM' %}
      {% include 'snippets/range_slider.html' %}
      {% endwith %}





      <script>
        // Adapted from https://www.creative-tim.com/twcomponents/component/multi-range-slider        
        function range(min, max, minValInput = null, maxValInput = null) {
          return {
            minVal: minValInput ?? min,
            maxVal: maxValInput ?? max,
            min: min,
            max: max,
            // minVal: 100,
            // maxVal: 10000,
            // min: 100,
            // max: 10000,
            minthumb: 0,
            maxthumb: 0,

            mintrigger() {
              this.minVal = Math.min(this.minVal, this.maxVal - 1);
              this.minthumb = ((this.minVal - this.min) / (this.max - this.min)) * 100;

            },

            maxtrigger() {
              this.maxVal = Math.max(this.maxVal, this.minVal + 1);
              this.maxthumb = 100 - (((this.maxVal - this.min) / (this.max - this.min)) * 100);
            },
          }
        }

        function submitForm() {
          document.getElementById('search_tracks').submit();
        }

        document.querySelectorAll('#search_tracks input, #search_sets select').forEach(element => {
    element.addEventListener('change', () => {
      console.log('submit')
      submitForm();
    });
  });

      </script>
    </div>




  </div>



</form>

<div class="flex flex-col items-center justify-center">
  <h1 class="text-xl font-semibold mt-8 mb-4">New Tracks</h1>

  {% include 'tracklist.html' %}

</div>

<div class="mt-8 flex justify-center space-x-4">
  {% if is_paginated %}
  {% if pagination.prev_url %}
  <a href="{{ pagination.prev_url }}" class="px-4 py-2 btn-primary btn rounded-full">Previous</a>
  {% endif %}
  {% if pagination.next_url %}
  <a href="{{ pagination.next_url }}" class="px-4 py-2 btn-primary btn rounded-full">Next</a>
  {% endif %}
  {% endif %}
</div>


<audio id="audio-player" controls class="fixed  bottom-2 left-1/2 transform -translate-x-1/2 z-50 hidden">
  Your browser does not support the audio element.
</audio>



{% include 'js_tracklist_no_vid.html' %}







{% endblock %}