{% include 'snippets/track_css.html' %}
{% include 'snippets/track_svg.html' %}


<div class="fixed inset-0 bg-transparent z-50 pointer-events-auto hidden" id="block-interactions"></div>

<div class="w-64  bg-primary-content p-4 m-4 rounded-xl shadow-xl border-2 absolute z-50 invisible" id="track-options-contextual-menu">
  <!-- First Title -->
  <h2 class="text-lg font-semibold mb-2 text-primary">Add to playlist...</h2>
  <!-- First Section -->
  <div class="overflow-y-auto max-h-40 mb-4">

    <ul class="space-y-1">
      {% if user_playlists|length == 0 %}
      <div class="justify-center content-center">
        <a href="{{url_for('playlist.playlist_create',next=current_url)}}" class="block p-2 rounded-xl hover:bg-blue-950">Create Your First Playlist...</a>
      </div>
      {% else %}
      {% for playlist in user_playlists %}
      <li class="flex m-0"><a data-playlist-id="{{playlist.id}}" href="#" class="add-track-to-playlist p-2 rounded-xl hover:bg-blue-950"><span class="line-clamp-1">{{playlist.title}}</span></a></li>
      {% endfor %}
      {% endif %}
    </ul>
  </div>

  <!-- Second Title -->
  <h2 class="text-lg font-semibold mb-2 text-primary">Other</h2>
  <!-- Second Section -->
  <div class="overflow-y-auto max-h-40">
    <ul class="space-y-1">
      <li><a href="{{url_for('playlist.playlist_create',next=current_url)}}" class="block p-2  rounded-xl hover:bg-blue-950">Create a Playlist</a></li>

    </ul>
  </div>
</div>



<div class="w-full text-left mt-4">
  <div>
    <div id="playlist">
      {% if tracks|length != 0 %}
      {% set max_track = [8, tracks|length] | min %}
      {% set insert_index = range(4, max_track + 1) | random %}
      {% for track in tracks %}
      {% set loop_index = loop.index %}
      {% include 'snippets/track.html' %}
      {% if loop.index == insert_index and not current_user.is_authenticated%}
      {% include 'snippets/about_inline.html' %}
      {% endif %}
      {% endfor %}
    </div>
    <div id="track-control" class="fixed left-0 right-0 bottom-0 z-50 bg-black">
      {% set track = tracks[0] %}
      <div class="flex items-center">
        <div class="w-2/12 p-2 text-white">
          <img class="cover_art" src="{{ track.cover_art }}" alt="">
        </div>
        <div class="w-8/12 p-2 pl-0 text-white text-xs overflow-hidden relative">
          <div class="title font-bold line-clamp-1" id="scrollingText">{{track.title}}</div>
          <div class="artist_name line-clamp-1 ">{{track.artist_name}}</div>
        </div>
        <div class="w-2/12 bg-grey-500 p-4 text-white">
          <div id="action-pause" class="cursor-pointer">
            <svg class="w-6 h-6 fill-white pointer-events-none">
              <use xlink:href="#icon-pause"></use>
            </svg>
          </div>
          <div id="action-play" class="hidden cursor-pointer">
            <svg class="w-6 h-6 fill-white pointer-events-none">
              <use xlink:href="#icon-play"></use>
            </svg>
          </div>
        </div>

      </div>
      <div class="w-full h-1 -mt-1 relative">
        <div id="track-progress" class="absolute top-0 left-0 h-full bg-[#9E7FFF]" style="width: 0%;"></div>
      </div>
    </div>

    {% else %}
    <div class=" text-gray-500 py-10">
      <p>Nothing found.

      </p>
    </div>
    {% endif %}
  </div>
</div>
<audio id="previewPlayer" controls class="absolute  bottom-2 left-1/2 transform -translate-x-1/2 z-50 hidden">
  Your browser does not support the audio element.
</audio>

{% include 'snippets/popover_track.html' %}
{% include 'js_tracklist.html' %}